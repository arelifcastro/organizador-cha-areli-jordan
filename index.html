<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chá de Cozinha Pro - Gestão Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, addDoc, deleteDoc, writeBatch, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.FirebaseSDK = { 
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken,
            onAuthStateChanged, getFirestore, doc, setDoc, collection, 
            onSnapshot, addDoc, deleteDoc, writeBatch, query
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .shadow-soft { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.04); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .detail-modal-bg { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); }
        .transition-colors-custom { transition: color 0.3s, background-color 0.3s, border-color 0.3s; }
        .upload-small { border: 2px dashed #e2e8f0; transition: all 0.2s; }
        .upload-small:hover { border-color: currentColor; background: rgba(255,255,255,0.8); }
        
        /* Indicadores RSVP na lateral */
        .rsvp-pending { border-left: 6px solid #60a5fa; } 
        .rsvp-confirmed { border-left: 6px solid #10b981; }
        .rsvp-rejected { border-left: 6px solid #f43f5e; }
        
        .dash-card { transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent; }
        .dash-card:hover { transform: translateY(-4px); border-color: rgba(236, 72, 153, 0.2); background-color: #fdf2f8; }

        /* Notificações Flutuantes */
        .toast-container { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 200; pointer-events: none; }
        .toast-base { 
            pointer-events: auto;
            padding: 0.75rem 1.25rem; 
            border-radius: 1rem; 
            font-size: 0.75rem; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            gap: 0.6rem; 
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            animation: toast-slide-in 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            min-width: 240px;
        }
        @keyframes toast-slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast-error { background: #ffffff; color: #991b1b; border: 1px solid #fee2e2; border-left: 4px solid #f87171; }
        .toast-success { background: #ffffff; color: #065f46; border: 1px solid #d1fae5; border-left: 4px solid #34d399; }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        const CATEGORIES = ["Família Noiva", "Família Noivo", "Amigos Noiva", "Amigos Noivo", "Igreja", "Padrinhos Noiva", "Padrinhos Noivo", "Amigos Comum", "Outros"];
        const MENU_CATEGORIES = ["Entrada", "Coffee Break", "Sobremesa"];
        const RSVP_STATUS = ["Pendente", "Confirmado", "Recusado"];

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Users: <><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>,
                Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2a2 2 0 0 1-2 2a2 2 0 0 0-2 2a2 2 0 0 1-2 2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2a2 2 0 0 1 2 2a2 2 0 0 0 2 2a2 2 0 0 1 2 2a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2a2 2 0 0 0 2-2a2 2 0 0 0 2-2a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2a2 2 0 0 1-2-2a2 2 0 0 0-2-2a2 2 0 0 1-2-2a2 2 0 0 0-2-2ZM9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0Z"/></>,
                Plus: <><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></>,
                Trash: <><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></>,
                Camera: <><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></>,
                X: <><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></>,
                Gift: <><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></>,
                Search: <><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/></>,
                User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
                Calendar: <><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>,
                Coffee: <><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></>,
                Sparkles: <><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></>,
                ClipboardList: <><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></>,
                Check: <><polyline points="20 6 9 17 4 12"/></>,
                Clock: <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
                Image: <><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></>,
                AlertCircle: <><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const App = () => {
            const [sdk, setSdk] = useState(null);
            const [db, setDb] = useState(null);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('guests');
            const [loading, setLoading] = useState(true);
            const [guests, setGuests] = useState([]);
            const [schedule, setSchedule] = useState([]);
            const [menu, setMenu] = useState([]);
            const [favors, setFavors] = useState([]);
            const [settings, setSettings] = useState({
                title: 'O Nosso Chá de Cozinha',
                subtitle: 'Cerimonial de Luxo',
                primaryColor: '#ec4899',
                secondaryColor: '#db2777',
                tertiaryColor: '#fdf2f8',
                labels: { guests: 'Lista', schedule: 'Cronograma', menu: 'Menu', favors: 'Lembranças', settings: 'Ajustes' }
            });

            const [searchTerm, setSearchTerm] = useState('');
            const [filterCategory, setFilterCategory] = useState('Todas');
            const [presenceFilter, setPresenceFilter] = useState('Todas');
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [isImporting, setIsImporting] = useState(false);
            const [importText, setImportText] = useState('');
            const [feedback, setFeedback] = useState({ message: '', type: '' });
            const [editingGuest, setEditingGuest] = useState(null);
            const [selectedGuestView, setSelectedGuestView] = useState(null);
            
            const [itemToDelete, setItemToDelete] = useState(null);
            const [dashboardListView, setDashboardListView] = useState(null);

            const firebaseConfig = {
                apiKey: "AIzaSyD6XXGyXShR1eaPcvIx2mvDcMgLgLRX7Jk",
                authDomain: "organizador-cha-4cbb0.firebaseapp.com",
                projectId: "organizador-cha-4cbb0",
                storageBucket: "organizador-cha-4cbb0.firebasestorage.app",
                messagingSenderId: "52706299052",
                appId: "1:52706299052:web:d7096db801b9da9e8da309"
            };
            
            const appId = 'organizador-cha-4cbb0';

            useEffect(() => {
                const init = async () => {
                    const safetyTimeout = setTimeout(() => setLoading(false), 8000);

                    if (!window.FirebaseSDK) {
                        setTimeout(init, 200);
                        return;
                    }
                    
                    const firebase = window.FirebaseSDK;
                    setSdk(firebase);

                    try {
                        const app = firebase.initializeApp(firebaseConfig);
                        const auth = firebase.getAuth(app);
                        const firestore = firebase.getFirestore(app);
                        setDb(firestore);

                        const initAuth = async () => {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                try {
                                    await firebase.signInWithCustomToken(auth, __initial_auth_token);
                                } catch (e) {
                                    await firebase.signInAnonymously(auth);
                                }
                            } else {
                                await firebase.signInAnonymously(auth);
                            }
                        };

                        await initAuth();

                        const unsubscribeAuth = firebase.onAuthStateChanged(auth, (u) => {
                            setUser(u);
                            if (u) {
                                syncData(firebase, firestore);
                                clearTimeout(safetyTimeout);
                            } else {
                                setLoading(false);
                            }
                        });

                        return () => unsubscribeAuth();
                    } catch (e) {
                        console.error("Erro Crítico:", e);
                        setLoading(false);
                    }
                };

                init();
            }, []);

            const syncData = (firebase, firestore) => {
                const basePath = ['artifacts', appId, 'public', 'data'];
                
                firebase.onSnapshot(firebase.doc(firestore, ...basePath, 'config', 'settings'), 
                    (d) => {
                        if (d.exists()) setSettings(prev => ({ ...prev, ...d.data() }));
                        setLoading(false);
                    }, 
                    (err) => setLoading(false)
                );

                const syncCollection = (name, setter) => {
                    firebase.onSnapshot(firebase.collection(firestore, ...basePath, name), 
                        (snap) => setter(snap.docs.map(doc => ({ id: doc.id, ...doc.data() }))),
                        (err) => console.error(err)
                    );
                };

                syncCollection('guests', setGuests);
                syncCollection('schedule', setSchedule);
                syncCollection('menu', setMenu);
                syncCollection('favors', setFavors);
            };

            const handleSave = async (col, data, id = null) => {
                if (!user || !sdk || !db) return;
                try {
                    const colPath = ['artifacts', appId, 'public', 'data', col];
                    if (id) {
                        await sdk.setDoc(sdk.doc(db, ...colPath, id), data, { merge: true });
                    } else {
                        await sdk.addDoc(sdk.collection(db, ...colPath), { ...data, createdAt: Date.now() });
                    }
                    setFeedback({ message: 'Dados guardados!', type: 'success' });
                    setTimeout(() => setFeedback({ message: '', type: '' }), 2500);
                } catch (e) { 
                    setFeedback({ message: 'Erro ao gravar!', type: 'error' });
                    setTimeout(() => setFeedback({ message: '', type: '' }), 3000);
                }
            };

            const confirmDelete = async () => {
                if (!user || !sdk || !db || !itemToDelete) return;
                try {
                    const { col, id } = itemToDelete;
                    await sdk.deleteDoc(sdk.doc(db, 'artifacts', appId, 'public', 'data', col, id));
                    setFeedback({ message: 'Removido com sucesso!', type: 'success' });
                    setItemToDelete(null);
                    setTimeout(() => setFeedback({ message: '', type: '' }), 2500);
                } catch (e) {
                    setFeedback({ message: 'Erro ao eliminar!', type: 'error' });
                    setTimeout(() => setFeedback({ message: '', type: '' }), 3000);
                }
            };

            const handlePhotoUpload = (e, callback) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = () => callback(reader.result);
                reader.readAsDataURL(file);
            };

            const handleBulkImport = async () => {
                if (!importText.trim() || !sdk || !user || !db || isImporting) return;
                setIsImporting(true);
                const lines = importText.split('\n').filter(l => l.trim());
                try {
                    const batch = sdk.writeBatch(db);
                    const colRef = sdk.collection(db, 'artifacts', appId, 'public', 'data', 'guests');
                    lines.forEach((line, i) => {
                        const parts = line.split(/[-–—]/);
                        batch.set(sdk.doc(colRef), { 
                            name: parts[0]?.trim() || "Convidada", 
                            category: "Outros", rsvp: 'Pendente', arrived: false, 
                            gift: '', giftId: '', photo: '', giftPhoto: '',
                            createdAt: Date.now() + i 
                        });
                    });
                    await batch.commit();
                    setIsImportModalOpen(false);
                    setImportText('');
                    setFeedback({ message: `${lines.length} convidadas importadas!`, type: 'success' });
                    setTimeout(() => setFeedback({ message: '', type: '' }), 3000);
                } finally { setIsImporting(false); }
            };

            const stats = useMemo(() => {
                const confirmed = guests.filter(g => g.rsvp === 'Confirmado');
                const absent = guests.filter(g => g.rsvp === 'Recusado');
                const arrived = guests.filter(g => g.arrived);
                return {
                    total: guests.length,
                    confirmed: confirmed.length,
                    absent: absent.length,
                    notArrived: confirmed.filter(g => !g.arrived).length,
                    arrived: arrived.length
                };
            }, [guests]);

            const filteredGuests = useMemo(() => {
                return guests.filter(g => {
                    const lowSearch = searchTerm.toLowerCase();
                    const matchesSearch = (g.name || "").toLowerCase().includes(lowSearch) || 
                                          (g.giftId || "").toString().toLowerCase().includes(lowSearch);
                    const matchesCat = filterCategory === 'Todas' || g.category === filterCategory;
                    
                    let matchesPres = true;
                    switch(presenceFilter) {
                        case 'Pendentes': matchesPres = g.rsvp === 'Confirmado' && !g.arrived; break;
                        case 'Já chegou': matchesPres = g.arrived; break;
                        case 'Ausentes': matchesPres = g.rsvp === 'Recusado'; break;
                        case 'Todas': matchesPres = true; break;
                    }

                    return matchesSearch && matchesCat && matchesPres;
                }).sort((a,b) => (a.name || "").localeCompare(b.name || ""));
            }, [guests, searchTerm, filterCategory, presenceFilter]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-white gap-4 text-center px-4">
                    <div className="w-12 h-12 border-4 border-slate-100 rounded-full animate-spin" style={{ borderTopColor: settings.primaryColor }}></div>
                    <p className="text-xs font-bold text-slate-400">A carregar organizador...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 transition-colors-custom" style={{ backgroundColor: settings.tertiaryColor }}>
                    {/* Contentor de Toasts Flutuantes */}
                    <div className="toast-container">
                        {feedback.message && (
                            <div className={`toast-base ${feedback.type === 'error' ? 'toast-error' : 'toast-success'}`}>
                                <Icon name={feedback.type === 'error' ? 'AlertCircle' : 'Check'} size={18} />
                                <span>{feedback.message}</span>
                            </div>
                        )}
                    </div>

                    <header className="glass sticky top-0 z-40 px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="text-center md:text-left cursor-pointer" onClick={() => { setActiveTab('guests'); setPresenceFilter('Todas'); }}>
                            <h1 className="text-xl md:text-2xl font-serif font-bold transition-colors-custom" style={{ color: settings.primaryColor }}>{settings.title}</h1>
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">{settings.subtitle}</p>
                        </div>
                        <nav className="flex gap-1 overflow-x-auto max-w-full pb-2 md:pb-0 no-scrollbar items-center">
                            {['guests', 'schedule', 'menu', 'favors', 'settings'].map((key) => (
                                <button key={key} onClick={() => setActiveTab(key)} className={`px-5 py-2.5 rounded-full text-[11px] font-bold uppercase tracking-wider transition-all whitespace-nowrap ${activeTab === key ? 'text-white shadow-lg' : 'text-slate-400 hover:bg-white/50'}`} style={activeTab === key ? { backgroundColor: settings.primaryColor } : {}}>
                                    {key === 'settings' ? <Icon name="Settings" size={16} /> : (settings.labels[key] || key)}
                                </button>
                            ))}
                        </nav>
                    </header>

                    <main className="max-w-6xl mx-auto px-6 mt-8">
                        {activeTab === 'guests' && (
                            <>
                                <section className="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 mb-10">
                                    {[
                                        { key: 'Todas', label: 'Lista', val: stats.total, color: 'text-slate-600' },
                                        { key: 'Confirmadas', label: 'Confirmadas', val: stats.confirmed, color: 'text-emerald-500' },
                                        { key: 'Ausentes', label: 'Ausentes', val: stats.absent, color: 'text-red-400' },
                                        { key: 'Não chegaram', label: 'Não chegaram', val: stats.notArrived, color: 'text-blue-500' },
                                        { key: 'Já chegou', label: 'Já chegou!', val: stats.arrived, color: 'text-emerald-700' }
                                    ].map((s, i) => (
                                        <div 
                                            key={s.key} 
                                            onClick={() => {
                                                let listToShow = [];
                                                switch(s.key) {
                                                    case 'Todas': listToShow = guests; break;
                                                    case 'Confirmadas': listToShow = guests.filter(g => g.rsvp === 'Confirmado'); break;
                                                    case 'Ausentes': listToShow = guests.filter(g => g.rsvp === 'Recusado'); break;
                                                    case 'Não chegaram': listToShow = guests.filter(g => g.rsvp === 'Confirmado' && !g.arrived); break;
                                                    case 'Já chegou': listToShow = guests.filter(g => g.arrived); break;
                                                }
                                                setDashboardListView({ title: s.label, list: listToShow });
                                            }}
                                            className={`dash-card p-5 rounded-[2rem] shadow-soft flex flex-col items-center text-center bg-white ${i === 4 ? 'col-span-2 md:col-span-1' : ''}`}
                                        >
                                            <span className="text-[9px] font-black uppercase tracking-tighter text-slate-400 mb-2 leading-none h-4 flex items-center">{s.label}</span>
                                            <span className={`text-2xl md:text-3xl font-serif font-bold ${s.color}`}>{s.val}</span>
                                        </div>
                                    ))}
                                </section>

                                <div className="space-y-8">
                                    <div className="flex flex-col xl:flex-row gap-4 justify-between items-center">
                                        <div className="relative w-full xl:w-96 shadow-soft rounded-2xl bg-white">
                                            <Icon name="Search" size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300" />
                                            <input type="text" placeholder="Procurar nome ou nº presente..." className="w-full pl-11 pr-4 py-3 rounded-2xl outline-none text-sm" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                        </div>
                                        <div className="flex flex-wrap gap-2 w-full xl:w-auto items-center">
                                            <div className="flex bg-white rounded-2xl shadow-soft p-1 overflow-x-auto no-scrollbar">
                                                {['Todas', 'Pendentes', 'Já chegou', 'Ausentes'].map(p => (
                                                    <button 
                                                        key={p} 
                                                        onClick={() => setPresenceFilter(p)} 
                                                        className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase transition-all whitespace-nowrap ${presenceFilter === p ? 'text-white shadow-lg' : 'text-slate-400 hover:bg-slate-50'}`}
                                                        style={presenceFilter === p ? { backgroundColor: settings.primaryColor } : {}}
                                                    >
                                                        {p}
                                                    </button>
                                                ))}
                                            </div>
                                            <button onClick={() => setIsImportModalOpen(true)} className="px-6 py-3 bg-white text-slate-400 rounded-2xl shadow-soft font-bold text-xs uppercase flex items-center gap-2"><Icon name="ClipboardList" size={16} /> Importar</button>
                                            <button onClick={() => setEditingGuest({ name: '', category: 'Família Noiva', rsvp: 'Pendente', arrived: false })} className="px-6 py-3 text-white rounded-2xl shadow-lg font-bold text-xs uppercase flex items-center gap-2" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" size={16} /> Nova</button>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredGuests.map(guest => (
                                            <div 
                                                key={guest.id} 
                                                onClick={() => setSelectedGuestView(guest)} 
                                                className={`bg-white p-6 rounded-[2.5rem] shadow-soft border-2 transition-all group relative cursor-pointer 
                                                    ${guest.rsvp === 'Recusado' ? 'border-red-400' : (guest.rsvp === 'Confirmado' && !guest.arrived) ? 'border-blue-400' : guest.rsvp === 'Confirmado' ? 'border-emerald-400' : 'border-transparent'}
                                                    ${presenceFilter === 'Todas' ? (guest.rsvp === 'Confirmado' ? 'rsvp-confirmed' : guest.rsvp === 'Recusado' ? 'rsvp-rejected' : 'rsvp-pending') : ''}
                                                `}
                                            >
                                                <div className="flex items-center gap-4 mb-6">
                                                    <div className="w-16 h-16 rounded-2xl bg-slate-50 overflow-hidden flex-shrink-0 border-2 border-white shadow-sm">
                                                        {guest.photo ? <img src={guest.photo} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-slate-200"><Icon name="User" size={24} /></div>}
                                                    </div>
                                                    <div className="flex-1 overflow-hidden">
                                                        <h3 className="text-lg font-serif font-bold text-slate-800 truncate leading-tight">{guest.name}</h3>
                                                        <p className="text-[10px] font-black uppercase tracking-widest mt-1" style={{ color: settings.secondaryColor }}>{guest.category}</p>
                                                    </div>
                                                    <div className="flex flex-col gap-1">
                                                        <button onClick={(e) => { e.stopPropagation(); setEditingGuest(guest); }} className="p-2 text-slate-300 hover:text-slate-600 transition-colors"><Icon name="Settings" size={14} /></button>
                                                        <button onClick={(e) => { e.stopPropagation(); setItemToDelete({ col: 'guests', id: guest.id, name: guest.name }); }} className="p-2 text-slate-200 hover:text-red-400 transition-colors"><Icon name="Trash" size={14} /></button>
                                                    </div>
                                                </div>

                                                <div className="flex items-center gap-4 p-4 bg-slate-50 rounded-3xl border border-slate-100 mb-4">
                                                    <div className="w-14 h-14 rounded-xl bg-white overflow-hidden flex-shrink-0 flex items-center justify-center shadow-sm border border-slate-100">
                                                        {guest.giftPhoto ? <img src={guest.giftPhoto} className="w-full h-full object-cover" /> : <Icon name="Gift" size={20} style={{ color: settings.primaryColor + '40' }} />}
                                                    </div>
                                                    <div className="flex-1 flex flex-col overflow-hidden">
                                                        <div className="flex items-center gap-2 mb-1">
                                                            {guest.giftId && <span className="px-2 py-0.5 rounded-md font-black text-[10px] text-white" style={{ backgroundColor: settings.primaryColor }}>#{guest.giftId}</span>}
                                                            <span className="text-[9px] font-black uppercase leading-none opacity-40">ITEM</span>
                                                        </div>
                                                        <p className="text-xs font-bold text-slate-700 truncate">{guest.gift || 'Não atribuído'}</p>
                                                    </div>
                                                </div>

                                                <button onClick={(e) => { e.stopPropagation(); handleSave('guests', { arrived: !guest.arrived }, guest.id); }} className={`w-full py-3.5 rounded-2xl font-bold text-[10px] uppercase tracking-widest transition-all ${guest.arrived ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 text-slate-400 hover:bg-slate-200'}`}>
                                                    {guest.arrived ? 'Já chegou' : 'Confirmar Entrada'}
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}
                        
                        {activeTab === 'schedule' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Cronograma</h2>
                                    <button onClick={() => handleSave('schedule', { date: '00:00', description: 'Nova atividade...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {schedule.sort((a,b) => a.date.localeCompare(b.date)).map(item => (
                                    <div key={item.id} className="bg-white p-5 rounded-[2rem] shadow-soft flex items-center gap-4 border">
                                        <label className="w-16 h-16 rounded-2xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Image" size={20} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('schedule', { photo: p }, item.id))} />
                                        </label>
                                        <input className="w-20 text-center font-bold text-xs p-2 bg-slate-50 rounded-xl outline-none" value={item.date} onChange={e => handleSave('schedule', { date: e.target.value }, item.id)} />
                                        <input className="flex-1 font-bold text-slate-700 p-2 outline-none" value={item.description} onChange={e => handleSave('schedule', { description: e.target.value }, item.id)} />
                                        <button onClick={() => setItemToDelete({ col: 'schedule', id: item.id, name: item.description })} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'menu' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Menu</h2>
                                    <button onClick={() => handleSave('menu', { category: 'Entrada', description: 'Novo prato...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {menu.map(item => (
                                    <div key={item.id} className="bg-white p-5 rounded-[2rem] shadow-soft flex items-center gap-4 border">
                                        <label className="w-16 h-16 rounded-2xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Coffee" size={20} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('menu', { photo: p }, item.id))} />
                                        </label>
                                        <div className="flex-1 flex flex-col gap-1">
                                            <select className="text-[9px] font-black uppercase w-fit bg-slate-50 px-2 py-1 rounded-md outline-none" value={item.category} onChange={e => handleSave('menu', { category: e.target.value }, item.id)}>
                                                {MENU_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                            <textarea className="font-bold text-slate-700 p-1 outline-none resize-none h-12" value={item.description} onChange={e => handleSave('menu', { description: e.target.value }, item.id)} />
                                        </div>
                                        <button onClick={() => setItemToDelete({ col: 'menu', id: item.id, name: item.description })} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'favors' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Lembranças</h2>
                                    <button onClick={() => handleSave('favors', { description: 'Nova lembrança...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {favors.map(item => (
                                    <div key={item.id} className="bg-white p-6 rounded-[2rem] shadow-soft flex items-center gap-6 border">
                                        <label className="w-20 h-20 rounded-3xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Sparkles" size={24} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('favors', { photo: p }, item.id))} />
                                        </label>
                                        <textarea className="flex-1 font-bold text-slate-700 p-2 outline-none resize-none" value={item.description} onChange={e => handleSave('favors', { description: e.target.value }, item.id)} />
                                        <button onClick={() => setItemToDelete({ col: 'favors', id: item.id, name: item.description })} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="max-w-2xl mx-auto bg-white p-10 rounded-[3rem] shadow-soft space-y-8 border">
                                <h2 className="text-2xl font-serif font-bold text-center">Identidade Visual</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase">Título</label>
                                        <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" value={settings.title} onChange={e => setSettings({...settings, title: e.target.value})} />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase">Subtítulo</label>
                                        <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" value={settings.subtitle} onChange={e => setSettings({...settings, subtitle: e.target.value})} />
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    <label className="text-[10px] font-bold text-slate-400 uppercase">Cores</label>
                                    <div className="grid grid-cols-3 gap-4">
                                        {['primaryColor', 'secondaryColor', 'tertiaryColor'].map(c => (
                                            <input key={c} type="color" className="w-full h-12 p-1 bg-slate-50 rounded-xl cursor-pointer" value={settings[c]} onChange={e => setSettings({...settings, [c]: e.target.value})} />
                                        ))}
                                    </div>
                                </div>
                                <button onClick={() => handleSave('config', settings, 'settings')} className="w-full py-4 text-white rounded-2xl font-bold uppercase shadow-lg hover:opacity-90" style={{ backgroundColor: settings.primaryColor }}>Guardar Todas as Definições</button>
                            </div>
                        )}
                    </main>

                    {/* MODAL LISTA DO DASHBOARD */}
                    {dashboardListView && (
                        <div className="fixed inset-0 z-[80] flex items-center justify-center p-4 detail-modal-bg animate-in fade-in duration-300">
                            <div className="bg-white w-full max-w-lg rounded-[3rem] shadow-2xl overflow-hidden relative flex flex-col max-h-[85vh]">
                                <div className="p-8 border-b flex justify-between items-center bg-slate-50">
                                    <div>
                                        <h3 className="text-2xl font-serif font-bold leading-none">{dashboardListView.title}</h3>
                                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-2">{dashboardListView.list.length} convidadas encontradas</p>
                                    </div>
                                    <button onClick={() => setDashboardListView(null)} className="p-3 bg-white rounded-2xl text-slate-300 shadow-sm hover:text-pink-500 transition-all"><Icon name="X" /></button>
                                </div>
                                
                                <div className="flex-1 overflow-y-auto p-8 no-scrollbar">
                                    {dashboardListView.list.length === 0 ? (
                                        <p className="text-center text-slate-300 font-medium py-10 italic">Nenhuma convidada nesta categoria.</p>
                                    ) : (
                                        <div className="space-y-3">
                                            {dashboardListView.list.sort((a,b) => (a.name || "").localeCompare(b.name || "")).map((g, idx) => (
                                                <div key={g.id} className="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100">
                                                    <div className="flex items-center gap-3">
                                                        <span className="text-[10px] font-black text-slate-200 w-4">{idx + 1}</span>
                                                        <div>
                                                            <p className="font-bold text-slate-800 text-sm leading-none">{g.name}</p>
                                                            <p className="text-[9px] font-black uppercase text-pink-400 mt-1 tracking-tighter">{g.category}</p>
                                                        </div>
                                                    </div>
                                                    {g.giftId && (
                                                        <span className="text-[10px] font-black px-2 py-1 bg-white rounded-lg border text-slate-400">#{g.giftId}</span>
                                                    )}
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                <div className="p-6 bg-slate-50 border-t flex justify-center">
                                    <button onClick={() => setDashboardListView(null)} className="px-10 py-3 text-white rounded-2xl font-bold text-[10px] uppercase tracking-widest shadow-lg" style={{ backgroundColor: settings.primaryColor }}>Fechar Lista</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL DETALHES (TELA EXPANDIDA) */}
                    {selectedGuestView && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 detail-modal-bg animate-in fade-in duration-300">
                            <div className="bg-white w-full max-w-2xl rounded-[3rem] shadow-2xl overflow-hidden relative p-10">
                                <button onClick={() => setSelectedGuestView(null)} className="absolute top-6 right-6 text-slate-300 hover:text-pink-500 transition-colors"><Icon name="X" /></button>
                                
                                <div className="flex flex-col md:flex-row gap-8">
                                    <div className="flex flex-col gap-4 items-center">
                                        <div className="w-40 h-40 rounded-[2.5rem] bg-slate-50 overflow-hidden shadow-lg border relative">
                                            {selectedGuestView.photo ? <img src={selectedGuestView.photo} className="w-full h-full object-cover" /> : <Icon name="User" size={60} className="m-auto mt-10 text-slate-200" />}
                                            {selectedGuestView.arrived && (
                                                <div className="absolute top-2 right-2 bg-emerald-500 text-white p-1.5 rounded-lg shadow-lg">
                                                    <Icon name="Check" size={14} />
                                                </div>
                                            )}
                                        </div>
                                        <div className="w-40 h-40 rounded-3xl bg-slate-50 overflow-hidden shadow-md border">
                                            {selectedGuestView.giftPhoto ? <img src={selectedGuestView.giftPhoto} className="w-full h-full object-cover" /> : <Icon name="Gift" size={40} className="m-auto mt-14 text-slate-200" />}
                                        </div>
                                    </div>
                                    
                                    <div className="flex-1 space-y-6">
                                        <div>
                                            <div className="flex items-center gap-3 mb-2">
                                                <p className="text-[10px] font-black uppercase tracking-widest" style={{ color: settings.secondaryColor }}>{selectedGuestView.category}</p>
                                                {selectedGuestView.arrived && (
                                                    <span className="bg-emerald-100 text-emerald-700 text-[8px] font-black uppercase px-2 py-0.5 rounded-full border border-emerald-200">Já Chegou</span>
                                                )}
                                            </div>
                                            <h2 className="text-3xl font-serif font-bold leading-tight">{selectedGuestView.name}</h2>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-slate-50 p-4 rounded-2xl">
                                                <p className="text-[9px] font-bold text-slate-300 uppercase">RSVP</p>
                                                <p className="font-bold">{selectedGuestView.rsvp}</p>
                                            </div>
                                            
                                            <div className={`p-4 rounded-2xl transition-colors ${selectedGuestView.arrived ? 'bg-emerald-500 border border-emerald-600' : 'bg-slate-50'}`}>
                                                <p className={`text-[9px] font-bold uppercase ${selectedGuestView.arrived ? 'text-emerald-100' : 'text-slate-300'}`}>Status de Entrada</p>
                                                <p className={`font-bold ${selectedGuestView.arrived ? 'text-white' : 'text-slate-400'}`}>
                                                    {selectedGuestView.arrived ? 'PRESENÇA CONFIRMADA' : 'AGUARDANDO CHEGADA'}
                                                </p>
                                            </div>
                                        </div>

                                        <div className="bg-slate-50 p-6 rounded-2xl">
                                            <p className="text-[9px] font-bold text-slate-300 uppercase mb-2 leading-none">Presente: {selectedGuestView.giftId ? `#${selectedGuestView.giftId}` : '---'}</p>
                                            <p className="text-slate-600 font-medium text-sm">{selectedGuestView.gift || 'Sem descrição.'}</p>
                                        </div>

                                        <button 
                                            onClick={() => { handleSave('guests', { arrived: !selectedGuestView.arrived }, selectedGuestView.id); setSelectedGuestView(prev => ({...prev, arrived: !prev.arrived})); }} 
                                            className={`w-full py-4 rounded-2xl font-bold text-xs uppercase tracking-widest shadow-lg transition-all ${selectedGuestView.arrived ? 'bg-slate-100 text-slate-400' : 'text-white'}`} 
                                            style={!selectedGuestView.arrived ? { backgroundColor: settings.primaryColor } : {}}
                                        >
                                            {selectedGuestView.arrived ? 'Remover Entrada' : 'Confirmar Entrada'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL EDIÇÃO */}
                    {editingGuest && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-sm overflow-y-auto">
                            <div className="bg-white w-full max-w-xl rounded-[3rem] p-8 shadow-2xl my-auto">
                                <div className="flex justify-between items-center mb-6"><h3 className="text-xl font-serif font-bold">Ficha da Convidada</h3><button onClick={() => setEditingGuest(null)} className="p-2 text-slate-300"><Icon name="X" /></button></div>
                                <div className="space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                        <label className="h-32 rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center cursor-pointer overflow-hidden transition-colors hover:bg-slate-100">
                                            {editingGuest.photo ? <img src={editingGuest.photo} className="w-full h-full object-cover" /> : <Icon name="Camera" className="text-slate-200" />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => setEditingGuest({...editingGuest, photo: p}))} />
                                        </label>
                                        <label className="h-32 rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center cursor-pointer overflow-hidden transition-colors hover:bg-slate-100">
                                            {editingGuest.giftPhoto ? <img src={editingGuest.giftPhoto} className="w-full h-full object-cover" /> : <Icon name="Gift" className="text-slate-200" />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => setEditingGuest({...editingGuest, giftPhoto: p}))} />
                                        </label>
                                    </div>
                                    <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-sm" placeholder="Nome" value={editingGuest.name} onChange={e => setEditingGuest({...editingGuest, name: e.target.value})} />
                                    <div className="grid grid-cols-2 gap-4">
                                        <select className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-xs" value={editingGuest.category} onChange={e => setEditingGuest({...editingGuest, category: e.target.value})}>{CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}</select>
                                        <select className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-xs" value={editingGuest.rsvp} onChange={e => setEditingGuest({...editingGuest, rsvp: e.target.value})}>{RSVP_STATUS.map(s => <option key={s} value={s}>{s}</option>)}</select>
                                    </div>
                                    <div className="flex gap-4">
                                        <input className="w-24 p-4 bg-slate-50 rounded-2xl outline-none font-black text-center text-xs" placeholder="Nº ITEM" value={editingGuest.giftId} onChange={e => setEditingGuest({...editingGuest, giftId: e.target.value})} />
                                        <input className="flex-1 p-4 bg-slate-50 rounded-2xl outline-none font-medium text-xs" placeholder="O que é o presente?" value={editingGuest.gift} onChange={e => setEditingGuest({...editingGuest, gift: e.target.value})} />
                                    </div>
                                    <button onClick={() => { handleSave('guests', editingGuest, editingGuest.id); setEditingGuest(null); }} className="w-full py-4 text-white rounded-2xl font-bold shadow-lg" style={{ backgroundColor: settings.primaryColor }}>Salvar</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL IMPORTAÇÃO */}
                    {isImportModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-sm overflow-y-auto">
                            <div className="bg-white w-full max-w-2xl rounded-[2.5rem] p-8 shadow-2xl my-auto animate-in zoom-in duration-300">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="text-xl font-serif font-bold">Importação em Massa</h3>
                                    <button onClick={() => setIsImportModalOpen(false)} className="p-2 text-slate-300"><Icon name="X" /></button>
                                </div>
                                <textarea className="w-full h-64 p-5 bg-slate-50 rounded-2xl outline-none text-sm font-medium focus:ring-2 focus:ring-pink-100 transition-all resize-none mb-6" value={importText} onChange={e => setImportText(e.target.value)} disabled={isImporting} placeholder="Nome - Categoria" />
                                <div className="flex gap-4">
                                    <button onClick={() => setIsImportModalOpen(false)} className="flex-1 py-4 text-slate-400 font-bold uppercase text-xs" disabled={isImporting}>Cancelar</button>
                                    <button onClick={handleBulkImport} className="flex-[2] py-4 text-white rounded-2xl font-bold uppercase text-xs shadow-lg flex items-center justify-center gap-2" style={{ backgroundColor: settings.primaryColor }} disabled={isImporting}>
                                        {isImporting ? <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> : "Confirmar Importação"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL EXCLUSÃO */}
                    {itemToDelete && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-md">
                            <div className="bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl text-center">
                                <div className="w-16 h-16 bg-red-50 text-red-500 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <Icon name="Trash" size={32} />
                                </div>
                                <h3 className="text-xl font-serif font-bold mb-2">Eliminar Item?</h3>
                                <p className="text-sm text-slate-400 mb-8">Desejas eliminar "{itemToDelete.name}"?</p>
                                <div className="flex gap-3">
                                    <button onClick={() => setItemToDelete(null)} className="flex-1 py-3 text-slate-400 font-bold text-xs uppercase rounded-xl">Cancelar</button>
                                    <button onClick={confirmDelete} className="flex-1 py-3 bg-red-500 text-white font-bold text-xs uppercase rounded-xl shadow-lg">Eliminar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
