<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chá de Cozinha Pro - Gestão Total</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase SDK Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, onSnapshot, addDoc, deleteDoc, writeBatch, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        window.FirebaseSDK = { 
            initializeApp, getAuth, signInAnonymously, signInWithCustomToken,
            onAuthStateChanged, getFirestore, doc, setDoc, collection, 
            onSnapshot, addDoc, deleteDoc, writeBatch, query
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; transition: background-color 0.3s ease; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .shadow-soft { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.04); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .detail-modal-bg { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); }
        .transition-colors-custom { transition: color 0.3s, background-color 0.3s, border-color 0.3s; }
        .upload-small { border: 2px dashed #e2e8f0; transition: all 0.2s; }
        .upload-small:hover { border-color: currentColor; background: rgba(255,255,255,0.8); }
        
        .rsvp-pending { border-left: 6px solid #cbd5e1; }
        .rsvp-confirmed { border-left: 6px solid #10b981; }
        .rsvp-rejected { border-left: 6px solid #f43f5e; }
        
        .dash-card { transition: transform 0.3s ease; }
        .dash-card:hover { transform: translateY(-4px); }

        .toast-error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; padding: 1rem; border-radius: 1rem; margin-bottom: 1rem; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem; }
        .toast-success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; padding: 1rem; border-radius: 1rem; margin-bottom: 1rem; font-size: 0.75rem; font-weight: bold; display: flex; align-items: center; gap: 0.5rem; }
    </style>
</head>
<body class="text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const CATEGORIES = ["Família Noiva", "Família Noivo", "Amigos Noiva", "Amigos Noivo", "Igreja", "Padrinhos Noiva", "Padrinhos Noivo", "Amigos Comum", "Outros"];
        const MENU_CATEGORIES = ["Entrada", "Coffee Break", "Sobremesa"];
        const RSVP_STATUS = ["Pendente", "Confirmado", "Recusado"];

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Users: <><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></>,
                Settings: <><path d="M12.22 2h-.44a2 2 0 0 0-2 2a2 2 0 0 1-2 2a2 2 0 0 0-2 2a2 2 0 0 1-2 2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2a2 2 0 0 1 2 2a2 2 0 0 0 2 2a2 2 0 0 1 2 2a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2a2 2 0 0 1 2-2a2 2 0 0 0 2-2a2 2 0 0 1 2-2a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2a2 2 0 0 1-2-2a2 2 0 0 0-2-2a2 2 0 0 1-2-2a2 2 0 0 0-2-2ZM9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0Z"/></>,
                Plus: <><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></>,
                Trash: <><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></>,
                Camera: <><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></>,
                X: <><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></>,
                Gift: <><polyline points="20 12 20 22 4 22 4 12"/><rect width="20" height="5" x="2" y="7"/><line x1="12" x2="12" y1="22" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></>,
                Search: <><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/></>,
                User: <><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></>,
                Calendar: <><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></>,
                Coffee: <><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></>,
                Sparkles: <><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></>,
                ClipboardList: <><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></>,
                Check: <><polyline points="20 6 9 17 4 12"/></>,
                Clock: <><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></>,
                Image: <><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></>,
                AlertCircle: <><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {icons[name] || null}
                </svg>
            );
        };

        const App = () => {
            const [sdk, setSdk] = useState(null);
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('guests');
            const [loading, setLoading] = useState(true);
            const [guests, setGuests] = useState([]);
            const [schedule, setSchedule] = useState([]);
            const [menu, setMenu] = useState([]);
            const [favors, setFavors] = useState([]);
            const [settings, setSettings] = useState({
                title: 'O Nosso Chá de Cozinha',
                subtitle: 'Cerimonial de Luxo',
                primaryColor: '#ec4899',
                secondaryColor: '#db2777',
                tertiaryColor: '#fdf2f8',
                labels: { guests: 'Lista', schedule: 'Cronograma', menu: 'Menu', favors: 'Lembranças', settings: 'Ajustes' }
            });

            const [searchTerm, setSearchTerm] = useState('');
            const [filterCategory, setFilterCategory] = useState('Todas');
            const [presenceFilter, setPresenceFilter] = useState('Todas');
            const [isImportModalOpen, setIsImportModalOpen] = useState(false);
            const [isImporting, setIsImporting] = useState(false);
            const [importText, setImportText] = useState('');
            const [feedback, setFeedback] = useState({ message: '', type: '' });
            const [editingGuest, setEditingGuest] = useState(null);
            const [selectedGuestView, setSelectedGuestView] = useState(null);

            // ATUALIZADO: Novas credenciais do Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyD6XXGyXShR1eaPcvIx2mvDcMgLgLRX7Jk",
                authDomain: "organizador-cha-4cbb0.firebaseapp.com",
                projectId: "organizador-cha-4cbb0",
                storageBucket: "organizador-cha-4cbb0.firebasestorage.app",
                messagingSenderId: "52706299052",
                appId: "1:52706299052:web:d7096db801b9da9e8da309"
            };
            
            // ATUALIZADO: AppId para o novo projeto
            const appId = 'organizador-cha-4cbb0';

            useEffect(() => {
                const init = async () => {
                    const safetyTimeout = setTimeout(() => setLoading(false), 8000);

                    if (!window.FirebaseSDK) {
                        setTimeout(init, 200);
                        return;
                    }
                    
                    const firebase = window.FirebaseSDK;
                    setSdk(firebase);

                    try {
                        const app = firebase.initializeApp(firebaseConfig);
                        const auth = firebase.getAuth(app);
                        const db = firebase.getFirestore(app);

                        // Fluxo de Autenticação (Regra 3)
                        const initAuth = async () => {
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                try {
                                    await firebase.signInWithCustomToken(auth, __initial_auth_token);
                                } catch (e) {
                                    await firebase.signInAnonymously(auth);
                                }
                            } else {
                                await firebase.signInAnonymously(auth);
                            }
                        };

                        await initAuth();

                        firebase.onAuthStateChanged(auth, (u) => {
                            setUser(u);
                            if (u) {
                                syncData(firebase, db);
                                clearTimeout(safetyTimeout);
                            } else {
                                setLoading(false);
                            }
                        });
                    } catch (e) {
                        console.error("Erro Crítico:", e);
                        setLoading(false);
                    }
                };

                init();
            }, []);

            const syncData = (firebase, db) => {
                // Regra 1: Strict Paths
                const basePath = ['artifacts', appId, 'public', 'data'];
                
                // Configurações
                firebase.onSnapshot(firebase.doc(db, ...basePath, 'config', 'settings'), (d) => {
                    if (d.exists()) setSettings(prev => ({ ...prev, ...d.data() }));
                    setLoading(false);
                }, (err) => {
                    console.error("Erro nas definições:", err);
                    setLoading(false);
                });

                // Coleções
                const syncCollection = (name, setter) => {
                    firebase.onSnapshot(firebase.collection(db, ...basePath, name), (snap) => {
                        setter(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    }, (err) => console.error(`Erro ao sincronizar ${name}:`, err));
                };

                syncCollection('guests', setGuests);
                syncCollection('schedule', setSchedule);
                syncCollection('menu', setMenu);
                syncCollection('favors', setFavors);
            };

            const handleSave = async (col, data, id = null) => {
                if (!user || !sdk) return;
                try {
                    const db = sdk.getFirestore();
                    const colPath = ['artifacts', appId, 'public', 'data', col];
                    
                    if (id) {
                        const docRef = sdk.doc(db, ...colPath, id);
                        await sdk.setDoc(docRef, data, { merge: true });
                    } else {
                        const colRef = sdk.collection(db, ...colPath);
                        await sdk.addDoc(colRef, { ...data, createdAt: Date.now() });
                    }
                    
                    setFeedback({ message: 'Dados guardados!', type: 'success' });
                    setTimeout(() => setFeedback({ message: '', type: '' }), 2000);
                } catch (e) { 
                    console.error("Erro ao gravar:", e);
                    setFeedback({ message: 'Erro ao gravar! Certifica-te que as regras do Firestore permitem escrita.', type: 'error' });
                }
            };

            const handleDelete = async (col, id) => {
                if (!user || !sdk || !confirm('Deseja eliminar este item?')) return;
                try {
                    await sdk.deleteDoc(sdk.doc(sdk.getFirestore(), 'artifacts', appId, 'public', 'data', col, id));
                } catch (e) {
                    setFeedback({ message: 'Erro ao eliminar!', type: 'error' });
                }
            };

            const handlePhotoUpload = (e, callback) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > 2000000) {
                    alert("Limite de 2MB excedido!");
                    return;
                }
                const reader = new FileReader();
                reader.onloadend = () => callback(reader.result);
                reader.readAsDataURL(file);
            };

            const handleBulkImport = async () => {
                if (!importText.trim() || !sdk || !user || isImporting) return;
                setIsImporting(true);
                const lines = importText.split('\n').filter(l => l.trim());
                try {
                    const db = sdk.getFirestore();
                    const batch = sdk.writeBatch(db);
                    const colRef = sdk.collection(db, 'artifacts', appId, 'public', 'data', 'guests');
                    
                    lines.forEach((line, i) => {
                        const parts = line.split(/[-–—]/);
                        let name = parts[0]?.trim() || "Convidada";
                        let category = "Outros";
                        if (parts[1]) {
                            const found = CATEGORIES.find(c => c.toLowerCase().includes(parts[1].trim().toLowerCase()));
                            if (found) category = found;
                        }
                        batch.set(sdk.doc(colRef), { 
                            name, category, rsvp: 'Pendente', arrived: false, 
                            gift: '', giftId: '', photo: '', giftPhoto: '',
                            createdAt: Date.now() + i 
                        });
                    });

                    await batch.commit();
                    setIsImportModalOpen(false);
                    setImportText('');
                    setFeedback({ message: `${lines.length} convidadas importadas!`, type: 'success' });
                } catch (e) {
                    setFeedback({ message: 'Erro na importação!', type: 'error' });
                } finally {
                    setIsImporting(false);
                }
            };

            const stats = useMemo(() => {
                const confirmed = guests.filter(g => g.rsvp === 'Confirmado');
                return {
                    total: guests.length,
                    confirmed: confirmed.length,
                    absent: guests.filter(g => g.rsvp === 'Recusado').length,
                    notArrived: confirmed.filter(g => !g.arrived).length,
                    arrived: guests.filter(g => g.arrived).length
                };
            }, [guests]);

            const filteredGuests = useMemo(() => {
                return guests.filter(g => {
                    const lowSearch = searchTerm.toLowerCase();
                    const matchesSearch = g.name?.toLowerCase().includes(lowSearch) || g.giftId?.toString().includes(searchTerm);
                    const matchesCat = filterCategory === 'Todas' || g.category === filterCategory;
                    const matchesPres = presenceFilter === 'Todas' || (presenceFilter === 'Pendentes' && !g.arrived) || (presenceFilter === 'Já chegou' && g.arrived);
                    return matchesSearch && matchesCat && matchesPres;
                }).sort((a,b) => (a.name || "").localeCompare(b.name || ""));
            }, [guests, searchTerm, filterCategory, presenceFilter]);

            if (loading) return (
                <div className="h-screen flex flex-col items-center justify-center bg-white gap-4">
                    <div className="w-12 h-12 border-4 border-slate-100 rounded-full animate-spin" style={{ borderTopColor: settings.primaryColor }}></div>
                    <p className="text-xs font-bold text-slate-400">A carregar organizador...</p>
                    <p className="text-[10px] text-slate-300">A estabelecer ligação com o Firestore em organizador-cha-4cbb0...</p>
                </div>
            );

            return (
                <div className="min-h-screen pb-20 transition-colors-custom" style={{ backgroundColor: settings.tertiaryColor }}>
                    <header className="glass sticky top-0 z-40 px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div className="text-center md:text-left cursor-pointer" onClick={() => setActiveTab('guests')}>
                            <h1 className="text-xl md:text-2xl font-serif font-bold transition-colors-custom" style={{ color: settings.primaryColor }}>{settings.title}</h1>
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">{settings.subtitle}</p>
                        </div>
                        <nav className="flex gap-1 overflow-x-auto max-w-full pb-2 md:pb-0 no-scrollbar items-center">
                            {['guests', 'schedule', 'menu', 'favors', 'settings'].map((key) => (
                                <button key={key} onClick={() => setActiveTab(key)} className={`px-5 py-2.5 rounded-full text-[11px] font-bold uppercase tracking-wider transition-all whitespace-nowrap ${activeTab === key ? 'text-white shadow-lg' : 'text-slate-400 hover:bg-white/50'}`} style={activeTab === key ? { backgroundColor: settings.primaryColor } : {}}>
                                    {key === 'settings' ? <Icon name="Settings" size={16} /> : (settings.labels[key] || key)}
                                </button>
                            ))}
                        </nav>
                    </header>

                    <main className="max-w-6xl mx-auto px-6 mt-8">
                        {feedback.message && (
                            <div className={feedback.type === 'error' ? 'toast-error' : 'toast-success'}>
                                <Icon name={feedback.type === 'error' ? 'AlertCircle' : 'Check'} size={16} />
                                {feedback.message}
                            </div>
                        )}

                        {activeTab === 'guests' && (
                            <>
                                <section className="grid grid-cols-2 md:grid-cols-5 gap-3 md:gap-4 mb-10">
                                    {[
                                        { label: settings.labels.guests, val: stats.total, color: 'text-slate-600', bg: 'bg-white' },
                                        { label: 'Confirmadas', val: stats.confirmed, color: 'text-emerald-500', bg: 'bg-white' },
                                        { label: 'Ausentes', val: stats.absent, color: 'text-red-400', bg: 'bg-white' },
                                        { label: 'Não chegaram', val: stats.notArrived, color: 'text-amber-500', bg: 'bg-white' },
                                        { label: 'Já chegou!', val: stats.arrived, color: 'text-emerald-700', bg: 'bg-emerald-50 border border-emerald-100' }
                                    ].map((s, i) => (
                                        <div key={i} className="dash-card p-5 rounded-[2rem] shadow-soft flex flex-col items-center text-center bg-white">
                                            <span className="text-[9px] font-black uppercase tracking-tighter text-slate-400 mb-2 leading-none h-4 flex items-center">{s.label}</span>
                                            <span className={`text-2xl md:text-3xl font-serif font-bold ${s.color}`}>{s.val}</span>
                                        </div>
                                    ))}
                                </section>

                                <div className="space-y-8">
                                    <div className="flex flex-col xl:flex-row gap-4 justify-between items-center">
                                        <div className="relative w-full xl:w-96 shadow-soft rounded-2xl bg-white">
                                            <Icon name="Search" size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-300" />
                                            <input type="text" placeholder="Procurar convidada..." className="w-full pl-11 pr-4 py-3 rounded-2xl outline-none text-sm" value={searchTerm} onChange={e => setSearchTerm(e.target.value)} />
                                        </div>
                                        <div className="flex flex-wrap gap-2 w-full xl:w-auto">
                                            <button onClick={() => setIsImportModalOpen(true)} className="px-6 py-3 bg-white text-slate-400 rounded-2xl shadow-soft font-bold text-xs uppercase flex items-center gap-2"><Icon name="ClipboardList" size={16} /> Importar</button>
                                            <button onClick={() => setEditingGuest({ name: '', category: 'Família Noiva', rsvp: 'Pendente', arrived: false })} className="px-6 py-3 text-white rounded-2xl shadow-lg font-bold text-xs uppercase flex items-center gap-2" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" size={16} /> Nova</button>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredGuests.map(guest => (
                                            <div key={guest.id} onClick={() => setSelectedGuestView(guest)} className={`bg-white p-6 rounded-[2.5rem] shadow-soft border transition-all cursor-pointer ${guest.rsvp === 'Confirmado' ? 'rsvp-confirmed' : guest.rsvp === 'Recusado' ? 'rsvp-rejected' : 'rsvp-pending'}`}>
                                                <div className="flex items-center gap-4 mb-6">
                                                    <div className="w-16 h-16 rounded-2xl bg-slate-50 overflow-hidden flex-shrink-0">
                                                        {guest.photo ? <img src={guest.photo} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center text-slate-100"><Icon name="User" size={24} /></div>}
                                                    </div>
                                                    <div className="flex-1">
                                                        <h3 className="text-lg font-serif font-bold text-slate-800 truncate">{guest.name}</h3>
                                                        <p className="text-[10px] font-black uppercase tracking-widest mt-1" style={{ color: settings.secondaryColor }}>{guest.category}</p>
                                                    </div>
                                                    <button onClick={(e) => { e.stopPropagation(); setEditingGuest(guest); }} className="p-2 text-slate-300 hover:text-slate-600"><Icon name="Settings" size={14} /></button>
                                                </div>
                                                <button onClick={(e) => { e.stopPropagation(); handleSave('guests', { arrived: !guest.arrived }, guest.id); }} className={`w-full py-3.5 rounded-2xl font-bold text-[10px] uppercase tracking-widest transition-all ${guest.arrived ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 text-slate-400'}`}>
                                                    {guest.arrived ? 'Já chegou' : 'Confirmar Entrada'}
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </>
                        )}

                        {activeTab === 'schedule' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Cronograma</h2>
                                    <button onClick={() => handleSave('schedule', { date: '00:00', description: 'Nova atividade...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {schedule.sort((a,b) => a.date.localeCompare(b.date)).map(item => (
                                    <div key={item.id} className="bg-white p-5 rounded-[2rem] shadow-soft flex items-center gap-4 border">
                                        <label className="w-16 h-16 rounded-2xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Image" size={20} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('schedule', { photo: p }, item.id))} />
                                        </label>
                                        <input className="w-20 text-center font-bold text-xs p-2 bg-slate-50 rounded-xl outline-none" value={item.date} onChange={e => handleSave('schedule', { date: e.target.value }, item.id)} />
                                        <input className="flex-1 font-bold text-slate-700 p-2 outline-none" value={item.description} onChange={e => handleSave('schedule', { description: e.target.value }, item.id)} />
                                        <button onClick={() => handleDelete('schedule', item.id)} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'menu' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Menu</h2>
                                    <button onClick={() => handleSave('menu', { category: 'Entrada', description: 'Novo prato...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {menu.map(item => (
                                    <div key={item.id} className="bg-white p-5 rounded-[2rem] shadow-soft flex items-center gap-4 border">
                                        <label className="w-16 h-16 rounded-2xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Coffee" size={20} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('menu', { photo: p }, item.id))} />
                                        </label>
                                        <div className="flex-1 flex flex-col gap-1">
                                            <select className="text-[9px] font-black uppercase w-fit bg-slate-50 px-2 py-1 rounded-md outline-none" value={item.category} onChange={e => handleSave('menu', { category: e.target.value }, item.id)}>
                                                {MENU_CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}
                                            </select>
                                            <textarea className="font-bold text-slate-700 p-1 outline-none resize-none h-12" value={item.description} onChange={e => handleSave('menu', { description: e.target.value }, item.id)} />
                                        </div>
                                        <button onClick={() => handleDelete('menu', item.id)} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'favors' && (
                            <div className="max-w-3xl mx-auto space-y-6">
                                <div className="flex justify-between items-center mb-4">
                                    <h2 className="text-2xl font-serif font-bold">Lembranças</h2>
                                    <button onClick={() => handleSave('favors', { description: 'Nova lembrança...', photo: '' })} className="p-3 rounded-full text-white shadow-lg" style={{ backgroundColor: settings.primaryColor }}><Icon name="Plus" /></button>
                                </div>
                                {favors.map(item => (
                                    <div key={item.id} className="bg-white p-6 rounded-[2rem] shadow-soft flex items-center gap-6 border">
                                        <label className="w-20 h-20 rounded-3xl overflow-hidden upload-small cursor-pointer flex items-center justify-center text-slate-200">
                                            {item.photo ? <img src={item.photo} className="w-full h-full object-cover" /> : <Icon name="Sparkles" size={24} />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => handleSave('favors', { photo: p }, item.id))} />
                                        </label>
                                        <textarea className="flex-1 font-bold text-slate-700 p-2 outline-none resize-none" value={item.description} onChange={e => handleSave('favors', { description: e.target.value }, item.id)} />
                                        <button onClick={() => handleDelete('favors', item.id)} className="text-slate-200 hover:text-red-400 p-2"><Icon name="Trash" size={16} /></button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {activeTab === 'settings' && (
                            <div className="max-w-2xl mx-auto bg-white p-10 rounded-[3rem] shadow-soft space-y-8 border">
                                <h2 className="text-2xl font-serif font-bold text-center">Identidade Visual</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase">Título</label>
                                        <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" value={settings.title} onChange={e => setSettings({...settings, title: e.target.value})} />
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase">Subtítulo</label>
                                        <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold" value={settings.subtitle} onChange={e => setSettings({...settings, subtitle: e.target.value})} />
                                    </div>
                                </div>
                                <div className="space-y-4">
                                    <label className="text-[10px] font-bold text-slate-400 uppercase">Cores</label>
                                    <div className="grid grid-cols-3 gap-4">
                                        {['primaryColor', 'secondaryColor', 'tertiaryColor'].map(c => (
                                            <input key={c} type="color" className="w-full h-12 p-1 bg-slate-50 rounded-xl cursor-pointer" value={settings[c]} onChange={e => setSettings({...settings, [c]: e.target.value})} />
                                        ))}
                                    </div>
                                </div>
                                <button onClick={() => handleSave('config', settings, 'settings')} className="w-full py-4 text-white rounded-2xl font-bold uppercase shadow-lg hover:opacity-90" style={{ backgroundColor: settings.primaryColor }}>Guardar Todas as Definições</button>
                            </div>
                        )}
                    </main>

                    {/* Modais de Detalhes e Ajustes omitidos para brevidade, mas funcionais no código completo */}
                    {/* Mantendo as referências completas para funcionamento total */}
                    {selectedGuestView && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 detail-modal-bg">
                            <div className="bg-white w-full max-w-2xl rounded-[3rem] shadow-2xl overflow-hidden relative p-10">
                                <button onClick={() => setSelectedGuestView(null)} className="absolute top-6 right-6 text-slate-300"><Icon name="X" /></button>
                                <div className="flex flex-col md:flex-row gap-8">
                                    <div className="flex flex-col gap-4 items-center">
                                        <div className="w-40 h-40 rounded-[2.5rem] bg-slate-50 overflow-hidden shadow-lg border">
                                            {selectedGuestView.photo ? <img src={selectedGuestView.photo} className="w-full h-full object-cover" /> : <Icon name="User" size={60} className="m-auto mt-10 text-slate-200" />}
                                        </div>
                                        <div className="w-40 h-40 rounded-3xl bg-slate-50 overflow-hidden shadow-md border">
                                            {selectedGuestView.giftPhoto ? <img src={selectedGuestView.giftPhoto} className="w-full h-full object-cover" /> : <Icon name="Gift" size={40} className="m-auto mt-14 text-slate-200" />}
                                        </div>
                                    </div>
                                    <div className="flex-1 space-y-6">
                                        <div>
                                            <p className="text-[10px] font-black uppercase tracking-widest mb-1" style={{ color: settings.secondaryColor }}>{selectedGuestView.category}</p>
                                            <h2 className="text-3xl font-serif font-bold leading-tight">{selectedGuestView.name}</h2>
                                        </div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-slate-50 p-4 rounded-2xl">
                                                <p className="text-[9px] font-bold text-slate-300 uppercase">RSVP</p>
                                                <p className="font-bold">{selectedGuestView.rsvp}</p>
                                            </div>
                                            <div className="bg-slate-50 p-4 rounded-2xl">
                                                <p className="text-[9px] font-bold text-slate-300 uppercase">Entrada</p>
                                                <p className="font-bold">{selectedGuestView.arrived ? 'Sim' : 'Não'}</p>
                                            </div>
                                        </div>
                                        <div className="bg-slate-50 p-6 rounded-2xl">
                                            <p className="text-[9px] font-bold text-slate-300 uppercase mb-2 leading-none">Presente: {selectedGuestView.giftId ? `#${selectedGuestView.giftId}` : '---'}</p>
                                            <p className="text-slate-600 font-medium">{selectedGuestView.gift || 'Sem descrição.'}</p>
                                        </div>
                                        <button onClick={() => { handleSave('guests', { arrived: !selectedGuestView.arrived }, selectedGuestView.id); setSelectedGuestView(null); }} className={`w-full py-4 rounded-2xl font-bold text-xs uppercase tracking-widest shadow-lg ${selectedGuestView.arrived ? 'bg-slate-100 text-slate-400' : 'text-white'}`} style={!selectedGuestView.arrived ? { backgroundColor: settings.primaryColor } : {}}>
                                            {selectedGuestView.arrived ? 'Cancelar Entrada' : 'Confirmar Entrada'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {editingGuest && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-sm overflow-y-auto">
                            <div className="bg-white w-full max-w-xl rounded-[3rem] p-8 shadow-2xl my-auto animate-in zoom-in duration-300">
                                <div className="flex justify-between items-center mb-6"><h3 className="text-xl font-serif font-bold">Ficha da Convidada</h3><button onClick={() => setEditingGuest(null)} className="p-2 text-slate-300"><Icon name="X" /></button></div>
                                <div className="space-y-6">
                                    <div className="grid grid-cols-2 gap-4">
                                        <label className="h-32 rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center cursor-pointer overflow-hidden transition-colors hover:bg-slate-100">
                                            {editingGuest.photo ? <img src={editingGuest.photo} className="w-full h-full object-cover" /> : <Icon name="Camera" className="text-slate-200" />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => setEditingGuest({...editingGuest, photo: p}))} />
                                        </label>
                                        <label className="h-32 rounded-3xl bg-slate-50 border-2 border-dashed flex flex-col items-center justify-center cursor-pointer overflow-hidden transition-colors hover:bg-slate-100">
                                            {editingGuest.giftPhoto ? <img src={editingGuest.giftPhoto} className="w-full h-full object-cover" /> : <Icon name="Gift" className="text-slate-200" />}
                                            <input type="file" className="hidden" accept="image/*" onChange={e => handlePhotoUpload(e, (p) => setEditingGuest({...editingGuest, giftPhoto: p}))} />
                                        </label>
                                    </div>
                                    <input className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-sm" placeholder="Nome da Convidada" value={editingGuest.name} onChange={e => setEditingGuest({...editingGuest, name: e.target.value})} />
                                    <div className="grid grid-cols-2 gap-4">
                                        <select className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-xs" value={editingGuest.category} onChange={e => setEditingGuest({...editingGuest, category: e.target.value})}>{CATEGORIES.map(c => <option key={c} value={c}>{c}</option>)}</select>
                                        <select className="w-full p-4 bg-slate-50 rounded-2xl outline-none font-bold text-xs" value={editingGuest.rsvp} onChange={e => setEditingGuest({...editingGuest, rsvp: e.target.value})}>{RSVP_STATUS.map(s => <option key={s} value={s}>{s}</option>)}</select>
                                    </div>
                                    <div className="flex gap-4">
                                        <input className="w-24 p-4 bg-slate-50 rounded-2xl outline-none font-black text-center text-xs" placeholder="Nº ITEM" value={editingGuest.giftId} onChange={e => setEditingGuest({...editingGuest, giftId: e.target.value})} />
                                        <input className="flex-1 p-4 bg-slate-50 rounded-2xl outline-none font-medium text-xs" placeholder="O que é o presente?" value={editingGuest.gift} onChange={e => setEditingGuest({...editingGuest, gift: e.target.value})} />
                                    </div>
                                    <div className="flex gap-4 pt-4">
                                        {editingGuest.id && <button onClick={() => handleDelete('guests', editingGuest.id)} className="flex-1 py-4 text-red-400 font-bold border rounded-2xl hover:bg-red-50 transition-colors">Eliminar</button>}
                                        <button onClick={() => { handleSave('guests', editingGuest, editingGuest.id); setEditingGuest(null); }} className="flex-[2] py-4 text-white rounded-2xl font-bold shadow-lg transition-opacity hover:opacity-90" style={{ backgroundColor: settings.primaryColor }}>Salvar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {isImportModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-900/40 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-2xl rounded-[2.5rem] p-8 shadow-2xl">
                                <h3 className="text-xl font-serif font-bold mb-4">Importação em Massa</h3>
                                <p className="text-[10px] text-slate-400 mb-4 bg-slate-50 p-3 rounded-xl">Formato: <strong>Nome - Categoria</strong> (ex: Maria - Família Noiva). Uma convidada por linha.</p>
                                <textarea className="w-full h-64 p-5 bg-slate-50 rounded-2xl outline-none text-sm font-medium focus:ring-2 focus:ring-pink-100 transition-all resize-none mb-6" value={importText} onChange={e => setImportText(e.target.value)} disabled={isImporting} placeholder="Nome - Categoria" />
                                <div className="flex gap-4">
                                    <button onClick={() => setIsImportModalOpen(false)} className="flex-1 py-4 text-slate-400 font-bold uppercase text-xs" disabled={isImporting}>Cancelar</button>
                                    <button onClick={handleBulkImport} className="flex-[2] py-4 text-white rounded-2xl font-bold uppercase text-xs shadow-lg flex items-center justify-center gap-2" style={{ backgroundColor: settings.primaryColor }} disabled={isImporting}>
                                        {isImporting ? <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div> : "Confirmar Importação"}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
